version: "3.6"

services:
  auth:
    build:
      context: "../../"
      dockerfile: "deployments/docker/auth/dev.Dockerfile"
    depends_on:
      - "psql"
    volumes:
      - ../../auth:/go/src/github.com/dakhipp/graphql-services/auth
    environment:
      - PORT=8080
      - PLAYGROUND=true
      - ENV=development
      - DATABASE_URL=postgres://root:toor@psql/psql?sslmode=disable

  graphql:
    build:
      context: "../../"
      dockerfile: "deployments/docker/graphql/dev.Dockerfile"
    ports:
      - "8000:8080"
    depends_on:
      - "auth"
    volumes:
      - ../../graphql:/go/src/github.com/dakhipp/graphql-services/graphql
    environment:
      - PORT=8080
      - PLAYGROUND=true
      - ENV=development
      - AUTH_SERVICE_URL=auth:8080

  psql:
    build:
      context: "../../"
      dockerfile: "deployments/psql/Dockerfile"
    environment:
      POSTGRES_DB: "psql"
      POSTGRES_USER: "root"
      POSTGRES_PASSWORD: "toor"
    restart: "unless-stopped"
